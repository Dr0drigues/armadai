<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ArmadAI</title>
<style>
  :root { --bg: #0d1117; --surface: #161b22; --border: #30363d; --text: #e6edf3; --muted: #8b949e; --accent: #58a6ff; --green: #3fb950; --yellow: #d29922; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
  header { background: var(--surface); border-bottom: 1px solid var(--border); padding: 12px 24px; display: flex; align-items: center; gap: 16px; }
  header h1 { font-size: 18px; font-weight: 600; }
  header h1 span { color: var(--accent); }
  nav { display: flex; gap: 4px; }
  nav button { background: none; border: 1px solid transparent; color: var(--muted); padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 14px; }
  nav button:hover { color: var(--text); }
  nav button.active { background: var(--bg); border-color: var(--border); color: var(--text); }
  main { max-width: 1200px; margin: 24px auto; padding: 0 24px; }
  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
  .card-header { padding: 12px 16px; border-bottom: 1px solid var(--border); font-weight: 600; font-size: 14px; color: var(--muted); }
  table { width: 100%; border-collapse: collapse; font-size: 14px; }
  th { text-align: left; padding: 8px 16px; color: var(--muted); font-weight: 500; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid var(--border); }
  td { padding: 10px 16px; border-bottom: 1px solid var(--border); }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: rgba(88,166,255,0.04); }
  .tag { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 12px; background: rgba(88,166,255,0.15); color: var(--accent); margin-right: 4px; }
  .tag.stack { background: rgba(63,185,80,0.15); color: var(--green); }
  .clickable { cursor: pointer; }
  .clickable:hover td:first-child { color: var(--accent); }
  .detail { padding: 20px; }
  .detail h2 { font-size: 20px; margin-bottom: 16px; }
  .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
  .detail-field label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px; text-transform: uppercase; }
  .detail-field span { font-size: 14px; }
  .prompt-box { background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: 16px; font-size: 14px; white-space: pre-wrap; line-height: 1.6; margin-bottom: 16px; }
  .prompt-box-title { font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 8px; }
  .back-btn { background: none; border: 1px solid var(--border); color: var(--text); padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 13px; margin-bottom: 16px; }
  .back-btn:hover { border-color: var(--accent); color: var(--accent); }
  .empty { padding: 40px; text-align: center; color: var(--muted); }
  .cost { color: var(--yellow); }
  .list-section { margin-bottom: 16px; }
  .list-section h3 { font-size: 14px; color: var(--muted); margin-bottom: 8px; text-transform: uppercase; }
  .list-section ul { list-style: none; padding: 0; }
  .list-section li { padding: 4px 0; font-size: 14px; }
  .list-section li::before { content: "â€¢ "; color: var(--accent); }
  #view { display: none; }
</style>
</head>
<body>
<header>
  <h1><span>Armad</span>AI</h1>
  <nav>
    <button class="active" onclick="showTab('agents')">Agents</button>
    <button onclick="showTab('prompts')">Prompts</button>
    <button onclick="showTab('skills')">Skills</button>
    <button onclick="showTab('starters')">Starters</button>
    <button onclick="showTab('history')">History</button>
    <button onclick="showTab('costs')">Costs</button>
  </nav>
</header>
<main>
  <div id="agents" class="card"></div>
  <div id="prompts" class="card" style="display:none"></div>
  <div id="skills" class="card" style="display:none"></div>
  <div id="starters" class="card" style="display:none"></div>
  <div id="history" class="card" style="display:none"></div>
  <div id="costs" class="card" style="display:none"></div>
  <div id="view" class="card"></div>
</main>
<script>
let currentTab = 'agents';
let viewBackTab = 'agents';

function showTab(tab) {
  document.querySelectorAll('nav button').forEach((b, i) => {
    const tabs = ['agents','prompts','skills','starters','history','costs'];
    b.classList.toggle('active', tabs[i] === tab);
  });
  ['agents','prompts','skills','starters','history','costs','view'].forEach(id => document.getElementById(id).style.display = 'none');
  document.getElementById(tab).style.display = 'block';
  currentTab = tab;
  if (tab === 'agents') loadAgents();
  if (tab === 'prompts') loadPrompts();
  if (tab === 'skills') loadSkills();
  if (tab === 'starters') loadStarters();
  if (tab === 'history') loadHistory();
  if (tab === 'costs') loadCosts();
}

async function loadAgents() {
  const res = await fetch('/api/agents');
  const agents = await res.json();
  const el = document.getElementById('agents');
  if (!agents.length) { el.innerHTML = '<div class="empty">No agents found. Create one with: armadai new my-agent</div>'; return; }
  el.innerHTML = `
    <div class="card-header">${agents.length} agents loaded</div>
    <table>
      <tr><th>Agent</th><th>Provider</th><th>Model</th><th>Tags</th><th>Stacks</th></tr>
      ${agents.map(a => `
        <tr class="clickable" onclick="viewAgent('${a.name}')">
          <td>${a.name}</td>
          <td>${a.provider}</td>
          <td>${a.model}</td>
          <td>${a.tags.map(t => `<span class="tag">${t}</span>`).join('')}</td>
          <td>${a.stacks.map(s => `<span class="tag stack">${s}</span>`).join('')}</td>
        </tr>`).join('')}
    </table>`;
}

async function viewAgent(name) {
  const res = await fetch(`/api/agents/${encodeURIComponent(name)}`);
  const a = await res.json();
  if (a.error) return;
  viewBackTab = 'agents';
  ['agents','prompts','skills','starters','history','costs'].forEach(id => document.getElementById(id).style.display = 'none');
  const el = document.getElementById('view');
  el.style.display = 'block';
  el.innerHTML = `
    <div class="detail">
      <button class="back-btn" onclick="backToList()">&larr; Back to agents</button>
      <h2>${a.name}</h2>
      <div class="detail-grid">
        <div class="detail-field"><label>Provider</label><span>${a.provider}</span></div>
        <div class="detail-field"><label>Model</label><span>${a.model}</span></div>
        <div class="detail-field"><label>Temperature</label><span>${a.temperature}</span></div>
        <div class="detail-field"><label>Max Tokens</label><span>${a.max_tokens || 'default'}</span></div>
        <div class="detail-field"><label>Timeout</label><span>${a.timeout ? a.timeout + 's' : 'default'}</span></div>
        <div class="detail-field"><label>Rate Limit</label><span>${a.rate_limit || 'none'}</span></div>
        <div class="detail-field"><label>Tags</label><span>${a.tags.map(t => `<span class="tag">${t}</span>`).join('') || 'none'}</span></div>
        <div class="detail-field"><label>Stacks</label><span>${a.stacks.map(s => `<span class="tag stack">${s}</span>`).join('') || 'none'}</span></div>
      </div>
      <div class="prompt-box-title">System Prompt</div>
      <div class="prompt-box">${a.system_prompt || '(none)'}</div>
      ${a.instructions ? `<div class="prompt-box-title">Instructions</div><div class="prompt-box">${a.instructions}</div>` : ''}
      ${a.output_format ? `<div class="prompt-box-title">Output Format</div><div class="prompt-box">${a.output_format}</div>` : ''}
      <div class="detail-field" style="margin-top:12px"><label>Source</label><span style="color:var(--muted)">${a.source}</span></div>
    </div>`;
}

async function loadPrompts() {
  const res = await fetch('/api/prompts');
  const prompts = await res.json();
  const el = document.getElementById('prompts');
  if (!prompts.length) { el.innerHTML = '<div class="empty">No prompts found. Add .md files to ~/.config/armadai/prompts/</div>'; return; }
  el.innerHTML = `
    <div class="card-header">${prompts.length} prompts loaded</div>
    <table>
      <tr><th>Name</th><th>Description</th><th>Applies To</th><th>Source</th></tr>
      ${prompts.map(p => `
        <tr class="clickable" onclick="viewPrompt('${p.name}')">
          <td>${p.name}</td>
          <td>${p.description || ''}</td>
          <td>${p.apply_to.map(a => `<span class="tag">${a}</span>`).join('')}</td>
          <td style="color:var(--muted)">${p.source}</td>
        </tr>`).join('')}
    </table>`;
}

async function viewPrompt(name) {
  const res = await fetch(`/api/prompts/${encodeURIComponent(name)}`);
  const p = await res.json();
  if (p.error) return;
  viewBackTab = 'prompts';
  ['agents','prompts','skills','starters','history','costs'].forEach(id => document.getElementById(id).style.display = 'none');
  const el = document.getElementById('view');
  el.style.display = 'block';
  el.innerHTML = `
    <div class="detail">
      <button class="back-btn" onclick="backToList()">&larr; Back to prompts</button>
      <h2>${p.name}</h2>
      <div class="detail-grid">
        <div class="detail-field"><label>Description</label><span>${p.description || '(none)'}</span></div>
        <div class="detail-field"><label>Applies To</label><span>${p.apply_to.map(a => `<span class="tag">${a}</span>`).join('') || 'none'}</span></div>
      </div>
      <div class="prompt-box-title">Content</div>
      <div class="prompt-box">${p.body || '(empty)'}</div>
      <div class="detail-field" style="margin-top:12px"><label>Source</label><span style="color:var(--muted)">${p.source}</span></div>
    </div>`;
}

async function loadSkills() {
  const res = await fetch('/api/skills');
  const skills = await res.json();
  const el = document.getElementById('skills');
  if (!skills.length) { el.innerHTML = '<div class="empty">No skills found. Install built-in skills with: armadai init --skills</div>'; return; }
  el.innerHTML = `
    <div class="card-header">${skills.length} skills loaded</div>
    <table>
      <tr><th>Name</th><th>Description</th><th>Version</th><th>Tools</th><th>Source</th></tr>
      ${skills.map(s => `
        <tr class="clickable" onclick="viewSkill('${s.name}')">
          <td>${s.name}</td>
          <td>${s.description || ''}</td>
          <td>${s.version || ''}</td>
          <td>${s.tools.map(t => `<span class="tag stack">${t}</span>`).join('')}</td>
          <td style="color:var(--muted)">${s.source}</td>
        </tr>`).join('')}
    </table>`;
}

async function viewSkill(name) {
  const res = await fetch(`/api/skills/${encodeURIComponent(name)}`);
  const s = await res.json();
  if (s.error) return;
  viewBackTab = 'skills';
  ['agents','prompts','skills','starters','history','costs'].forEach(id => document.getElementById(id).style.display = 'none');
  const el = document.getElementById('view');
  el.style.display = 'block';
  let filesHtml = '';
  if (s.scripts.length) filesHtml += `<div class="list-section"><h3>Scripts</h3><ul>${s.scripts.map(f => `<li>${f}</li>`).join('')}</ul></div>`;
  if (s.references.length) filesHtml += `<div class="list-section"><h3>References</h3><ul>${s.references.map(f => `<li>${f}</li>`).join('')}</ul></div>`;
  if (s.assets.length) filesHtml += `<div class="list-section"><h3>Assets</h3><ul>${s.assets.map(f => `<li>${f}</li>`).join('')}</ul></div>`;
  el.innerHTML = `
    <div class="detail">
      <button class="back-btn" onclick="backToList()">&larr; Back to skills</button>
      <h2>${s.name}</h2>
      <div class="detail-grid">
        <div class="detail-field"><label>Description</label><span>${s.description || '(none)'}</span></div>
        <div class="detail-field"><label>Version</label><span>${s.version || '(none)'}</span></div>
        <div class="detail-field"><label>Tools</label><span>${s.tools.map(t => `<span class="tag stack">${t}</span>`).join('') || 'none'}</span></div>
      </div>
      <div class="prompt-box-title">SKILL.md</div>
      <div class="prompt-box">${s.body || '(empty)'}</div>
      ${filesHtml}
      <div class="detail-field" style="margin-top:12px"><label>Source</label><span style="color:var(--muted)">${s.source}</span></div>
    </div>`;
}

async function loadStarters() {
  const res = await fetch('/api/starters');
  const starters = await res.json();
  const el = document.getElementById('starters');
  if (!starters.length) { el.innerHTML = '<div class="empty">No starter packs found.</div>'; return; }
  el.innerHTML = `
    <div class="card-header">${starters.length} starter packs</div>
    <table>
      <tr><th>Name</th><th>Description</th><th>Agents</th><th>Prompts</th><th>Skills</th></tr>
      ${starters.map(s => `
        <tr class="clickable" onclick="viewStarter('${s.name}')">
          <td>${s.name}</td>
          <td>${s.description}</td>
          <td>${s.agents_count}</td>
          <td>${s.prompts_count}</td>
          <td>${s.skills_count}</td>
        </tr>`).join('')}
    </table>`;
}

async function viewStarter(name) {
  const res = await fetch(`/api/starters/${encodeURIComponent(name)}`);
  const s = await res.json();
  if (s.error) return;
  viewBackTab = 'starters';
  ['agents','prompts','skills','starters','history','costs'].forEach(id => document.getElementById(id).style.display = 'none');
  const el = document.getElementById('view');
  el.style.display = 'block';
  el.innerHTML = `
    <div class="detail">
      <button class="back-btn" onclick="backToList()">&larr; Back to starters</button>
      <h2>${s.name}</h2>
      <p style="color:var(--muted);margin-bottom:20px">${s.description}</p>
      ${s.agents.length ? `<div class="list-section"><h3>Agents (${s.agents.length})</h3><ul>${s.agents.map(a => `<li>${a}</li>`).join('')}</ul></div>` : ''}
      ${s.prompts.length ? `<div class="list-section"><h3>Prompts (${s.prompts.length})</h3><ul>${s.prompts.map(p => `<li>${p}</li>`).join('')}</ul></div>` : ''}
      ${s.skills.length ? `<div class="list-section"><h3>Skills (${s.skills.length})</h3><ul>${s.skills.map(sk => `<li>${sk}</li>`).join('')}</ul></div>` : ''}
    </div>`;
}

function backToList() {
  document.getElementById('view').style.display = 'none';
  document.getElementById(viewBackTab).style.display = 'block';
}

async function loadHistory() {
  const res = await fetch('/api/history');
  const history = await res.json();
  const el = document.getElementById('history');
  if (!history.length) { el.innerHTML = '<div class="empty">No execution history yet.</div>'; return; }
  el.innerHTML = `
    <div class="card-header">${history.length} runs</div>
    <table>
      <tr><th>Agent</th><th>Provider</th><th>Model</th><th>Tokens In</th><th>Tokens Out</th><th>Cost</th><th>Duration</th><th>Status</th></tr>
      ${history.map(h => `
        <tr>
          <td>${h.agent}</td>
          <td>${h.provider}</td>
          <td>${h.model}</td>
          <td>${h.tokens_in}</td>
          <td>${h.tokens_out}</td>
          <td class="cost">$${h.cost.toFixed(6)}</td>
          <td>${h.duration_ms}ms</td>
          <td>${h.status}</td>
        </tr>`).join('')}
    </table>`;
}

async function loadCosts() {
  const res = await fetch('/api/costs');
  const costs = await res.json();
  const el = document.getElementById('costs');
  if (!costs.length) { el.innerHTML = '<div class="empty">No cost data yet.</div>'; return; }
  const total = costs.reduce((s, c) => s + c.total_cost, 0);
  el.innerHTML = `
    <div class="card-header">Cost summary &mdash; total: <span class="cost">$${total.toFixed(4)}</span></div>
    <table>
      <tr><th>Agent</th><th>Runs</th><th>Cost (USD)</th><th>Tokens In</th><th>Tokens Out</th></tr>
      ${costs.map(c => `
        <tr>
          <td>${c.agent}</td>
          <td>${c.total_runs}</td>
          <td class="cost">$${c.total_cost.toFixed(6)}</td>
          <td>${c.total_tokens_in}</td>
          <td>${c.total_tokens_out}</td>
        </tr>`).join('')}
    </table>`;
}

// Initial load
loadAgents();
</script>
</body>
</html>
